<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script> <!-- Headers for Leaflet API -->

    <link href="https://cdn.jsdelivr.net/npm/mc-datepicker/dist/mc-calendar.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/mc-datepicker/dist/mc-calendar.min.js"></script> <!-- Headers for date input buttons -->

    <link rel="stylesheet" href="DateButton.css">
    <meta charset="UTF-8">
    <title>Live GPS</title>
</head>

<body>
    <div id="KEY">cmm3C3yCX1jExK5nEp7f</div>
    <div id="fromTime">00000000</div>
    <div id="toTime">23595900</div>
    <div id="serverData"></div>

    <!-- YYMMDD, HHMMSS00, Latitude, Longitude, KM/H, Altitud, Direction, Quality, Satellites-->

    <div class="leaflet-top leaflet-right" style="pointer-events: auto;"> <!--- Map Buttons -->
        <div class="dateButtons">
            <button class="button type1" id="initialDateButton" onclick="initialDate.open()">Fecha Inicial</button>
            <button class="button type1" id="finalDateButton" onclick="finalDate.open()">Fecha Final</button>
            <br>
            <button class="button type2" id="sendDateButton" style="float: right;" onclick="CleanMapReadDateUpdateMap()">Actualizar</button>
        </div>

        <script>
            // Date buttons closes when the user clicks outside of the calendar and when a date is selected.
            const initialDate = MCDatepicker.create({ el: '#initialDateButton', dateFormat: 'YYYY-MM-DD',
                closeOnBlur: true, autoClose: true });

            const finalDate = MCDatepicker.create({ el: '#finalDateButton', dateFormat: 'YYYY-MM-DD',
                closeOnBlur: true, autoClose: true });

            const currentDate = new Date(); // Ensure that initially the dates are the same.
            // const yesterday = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - 1); // Using this for testing
            initialDate.setFullDate(currentDate); finalDate.setFullDate(currentDate);
        </script>
    </div>

    <div id="Map" style="position: fixed; top: 0; bottom: 0; left: 0; right: 0;"> </div>
    <script src="GenerateMap.js"></script>
    <script src="transformToServerDate.js"></script>
    <script src="ServerRequests.js"></script>
    <script src="UpdateMapData.js"></script>
    <script>
        function CleanMapReadDateUpdateMap()
        {
            // Removing the markers and the lines from the map.
            for (var i = 0; i < markers.length; i++) { markers[i].remove(); }
            polyline.remove();

            // Reading the date from the buttons.
            const fromDate = convertToServerDate(document.getElementById('initialDateButton').value);
            const toDate = convertToServerDate(document.getElementById('finalDateButton').value);
            const fromTime = document.getElementById('fromTime').innerHTML;
            const toTime = document.getElementById('toTime').innerHTML;

            // Downloading the new data from the server.
            const serverData = getServerData(fromDate, fromTime, toDate, toTime);
            document.getElementById('serverData').value = cleanServerData(serverData);

            // Updating the map with the new data.
            updateMapData();
        }
    </script>

</body>

</html>
